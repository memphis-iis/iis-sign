<!DOCTYPE html>
<html lang="en">
<head>
<title>Institute for Intelligent Systems</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
    body, html {
        margin: 0;
        padding: 0;
        border: none;
        width: 100%;
        height: 100%;
        overflow: hidden;
    }
    #sign {
        position:fixed;
        margin: 0;
        padding: 0;
        border: none;
        border: 6px red;
        overflow:hidden;
        top: 0;
        left: 0;
        bottom: 0;
        right: 0;
        width: 100%;
        height: 100%;
    }
</style>
</head>

<body>

<iframe src="#" width="100%" height="100%" id="sign" name="sign"></iframe>

<!-- JAVASCRIPT RESOURCES -->
<script type="text/javascript" src="/third-party/lodash.min.js"></script>
<script type="text/javascript" src="/third-party/jquery.min.js"></script>
<script type="text/javascript" src="/js/keys.js"></script>

<!-- Actual logic -->
<script type="text/javascript">
var PAGE_CHANGE_TIMEOUT = 28500;

var BLURB_URL = '/test/blurb.txt';
var SIGN_OVERRIDE_URL = '/test/blurb.txt';

var PAGES = [
    '/pages/main-logo.html',
    'https://umdrive.memphis.edu/hcogar/public/Cog%20Sci%20widescreen-projector-sign-021016.pdf',
    '/pages/projects.html',
    '/pages/calendar.html',
    '/pages/life.html',
    '/pages/people.html',
    '/pages/flock3d.html',
];

var PAGE_INDEX = null;

var NEXT_KEYS = {
    'space': true,
    'page-down': true,
    'down-arrow': true,
    'right-arrow': true,
    'n': true
};

var PREV_KEYS = {
    'page-up': true,
    'up-arrow': true,
    'left-arrow': true,
    'p': true
};

function buildUrl(base) {
    return base + '?rnd1=' + _.random(0xffff) + '&rnd2=' + _.random(0xffff);
}

function pageSet(idx) {
    console.log("Switching page from", PAGE_INDEX, "to", idx);
    PAGE_INDEX = idx;
    $('#sign').attr('src', buildUrl(PAGES[idx]));
}

function pageInc(inc) {
    var newIdx = (PAGE_INDEX + inc) % PAGES.length;

    // Allow reverse to wrap
    if (newIdx < 0) {
        newIdx = PAGES.length - 1;
    }

    if (newIdx === 0 && PAGE_INDEX === PAGES.length - 1) {
        // If we wrap from max to 0, force full page reload
        location.reload(true);
    }
    else {
        // Just act normal and reload the iframe
        pageSet(newIdx);
    }
}

function timedChange() {
    console.log("TIMED CHANGED");
    pageInc(1);
    setTimeout(timedChange, PAGE_CHANGE_TIMEOUT);
}

$(function(){
    $(document).keydown(function(e) {
        try {
            var ky = keys.xlate(e.keyCode);
            if      (ky == 'home')  pageSet(0);
            else if (ky == 'end')   pageSet(PAGES.length - 1);
            else if (NEXT_KEYS[ky]) pageInc(1);
            else if (PREV_KEYS[ky]) pageInc(-1);
        }
        catch(e) {
            console.log('document keydown capture error', e);
        }
    });

    // Give the very first page some special time
    pageSet(0);
    setTimeout(timedChange, PAGE_CHANGE_TIMEOUT * 1.5);
});
</script>

</body>
</html>
